(function (root) {
  function createDecoder(labels) {
    for (const label of labels) {
      try {
        return new TextDecoder(label);
      } catch (error) {
        continue;
      }
    }
    return null;
  }

  const decoder = createDecoder(['gbk', 'gb18030', 'x-user-defined']);

  function ensureUint8Array(data) {
    return data instanceof Uint8Array ? data : new Uint8Array(data);
  }

  root.GBK = {
    decode(data) {
      if (!decoder) {
        throw new Error('GBK decoder is not available in this environment.');
      }
      return decoder.decode(ensureUint8Array(data));
    },
  };
})(typeof self !== 'undefined' ? self : this);
